<!--?xml version="1.0" encoding="UTF-8"?-->
<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<title>MySQL - проблеми с колациите</title>
		<link rel="stylesheet" href="MySQL%20-%20%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%B8%20%D1%81%20%D0%BA%D0%BE%D0%BB%D0%B0%D1%86%D0%B8%D0%B8%D1%82%D0%B5_files/wireless.css" type="text/css">
	</head>
	<body>
		<p class="catbg">MySQL - проблеми с колациите</p>
		<p class="windowbg"><a href="http://archive.joomla.bg/forum/index.php?PHPSESSID=bb208294f95f26c136124c5fea758ba6&amp;topic=3165.0;wap2">&lt;&lt;</a> <a href="http://archive.joomla.bg/forum/index.php?PHPSESSID=bb208294f95f26c136124c5fea758ba6&amp;topic=3165.5;wap2">&lt;</a> (3/4) <a href="http://archive.joomla.bg/forum/index.php?PHPSESSID=bb208294f95f26c136124c5fea758ba6&amp;topic=3165.15;wap2">&gt;</a> <a href="http://archive.joomla.bg/forum/index.php?PHPSESSID=bb208294f95f26c136124c5fea758ba6&amp;topic=3165.15;wap2">&gt;&gt;</a> </p>
		<p class="windowbg">
			<b>Пенко Пенев</b>:<br>
			Сега смених колацията на цялата база ина всички таблици<br>Сега 
отново всичко се чете нормално - и на сайта и в phpMyAdmin, но ако се 
опитам да импортна данни на кирилица не се получава. Къде бъркам?
		</p>
		<p class="windowbg2">
			<b>Пенко Пенев</b>:<br>
			Нещо което може да е от полза на всеки<br>Копирано е от тук: http://www.hostbulgaria.com/tutorials/mysql-charset-encoding.aspx<br><br>MySQL и база данни с кирилица<br><br>Вероятно
 няма уебмастър в България, койото поне веднъж да не е успял да превърне
 съдържанието на база данни във въпросителни знаци при експорт / импорт 
на бакъп дъмп файл с phpmyadmin или през shell. Ето няколко насоки за 
mysql енкодинг (информацията е базирана на mysql сървър 4.1+ и 
PhpMyAdmin 2.6.4+).<br><br>Термини<br>Енкодинг (encoding, character 
encoding), чарсет (charset, character set) - Тези понятия описван начина
 по който се съхраняват символите във вид на някакъв цифров код. Примери
 за енкодинги са windows-1251 (в mysql е cp1251), utf-8 (в mysql е 
utf8), ISO-8859-1 кодировка и т.н.<br>Колация (collation) - Това е 
начина по който се интерпретира енкодинга. За всеки енкодинг може да има
 няколко колации и ако сортирате текстовите полета от някоя mysql 
таблица с различни колации, вероятно ще се подредят по различен начин. 
Една колация може да работи с един енкодинг само. В mysql не е нужно да 
задавате изрично колацията. Когато зададете енкодинг cp1251 примерно, 
mysql ще използва по подразбиране cp1251_general_ci collation (това важи
 за таблици, конекции и т.н.).<br><br>Първоначално създаване на база данни<br>При
 създаване на база данни, в която ще има текст на кирилица, най-добре е 
да се използва енкодинг (и колация) cp1251 или utf8 (unicode). Същото 
важи и за таблиците и полетата вътре.<br><br>Код:<br><br>CREATE {DATABASE | SCHEMA} [IF NOT EXISTS] db_name<br>&nbsp;[DEFAULT] CHARACTER SET charset_name<br>&nbsp;| [DEFAULT] COLLATE collation_name<br><br>Ако
 не бъде изрично зададен character set, ще се използва този, който е по 
подразбиране в съответния mysql сървър. В момента нашите cpanel хостинг 
сървъри са настроени за чарсет по подразбиране cp1251, но вероятно в 
бъдеще ще ползваме utf8 encoding, тъй като това е стандартната 
кодировка, за която са настроени повечето готови cms, е-магазин, форум и
 др. приложения с отворен код.<br>Енкодинга (чарсета) на базата данни в 
действителност не служи за нищо друго освен да зададе какъв енкодинг да 
се ползва за при създаването на таблиците. Table character set, table 
collation, както и енкодинга и колациите за самите текстови полета 
определят в какъв вид ще се съхранява текста.Mysql 4.1 и по-новите 
версии поддържат възможността да се зададе различен енкодинг и колация 
за всяка таблица или поле. Тези настройки можете лесно да променяте с 
PhpMyAdmin. Ако сменяте енкодинга на таблица или поле, трябва да се 
внимава да не се преминава към енкодинг, който липсват някои от 
символите в оригиналния енкодинг. Например няма проблем да смените от 
cp1251 към utf8, koi8r или binary. Ако в базата има само латиница и 
кирилица, можете да смените от utf8 към cp1251. Ще загубите всичката 
кирилица обаче, ако смените от utf8 или cp1251 към latin1 или latin2. 
Добро правило е винаги да правите бекъп преди да се заигравате базата си
 данни. Друго добро правило е, при смяна на кодировката, да преминавате 
през binary (utf8 → binary → cp1251).<br><br>Продължава ....
		</p>
		<p class="windowbg">
			<b>Пенко Пенев</b>:<br>
			Продължение .....<br><br>Изпълнение на заявки към база данни с кирилица<br>Правилно
 е да изберете един енкодинг за всички компоненти на вашия сайт. 
Например, ако изберете windows-1251 (cp1251), трябва или в http хедъра 
или с мета таг да укажете това за вашите php, cgi, aspx или други 
файлове. Освен това самия файл е ноебходимо да се запази със съответната
 кодировка. Например, опцията на Visual Studio (Express Edition е 
безплатен от сайта на Майкрософт) 'Save File As' има малка стрелкичка до
 бутона Save, където можете да изберете с какъв енкодинг да е файла. 
Вероятно вашият любим текстов редактор също поддържа такава опция. 
Проверете и настройките на вашия сървър скрипт. Примерно за PHP - 
default_charset в php.ini е най-добре да се остави коментирано, но може и
 default_charset = "windows-1251". Следващата стъпка е да настроите 
вашето приложение иmysql да обменят данни в един и същ енкодинг. 
Обикновено причината за въпросителни знаци по вашия сайт е именно заради
 факта, че двете си говорят на различни езици. Във конфигурационния файл
 наmysql може да бъде зададен енкодинг по подразбиране посредством 
character-set-server = cp1251 (default-character-set = cp1251) или 
init_connect = 'SET NAMES cp1251'. Вероятно обаче няма да имате 
възможност да редактирате конфигурацията на mysql сървъра ако ползвате 
услугите на хостинг компания. Какво ще стане ако на сървъра енкодинг по 
подразбиране е cp1251, а вашата база данни е с utf8 и вашите php файлове
 са съответно utf-8? На пръв поглед нищо няма да стане и ще работи (за 
съжаление)! Самите данни в базата ще се съхраняват в напълно грешен вид и
 проблема ще се появи едва когато се опитате да преместите базата данни 
на друг хостинг сървър или се опитате да я възстановите от backup. Някои
 от символите няма да могат вече да се четат ('ш', 'И', ...). Ако сте я 
докарали до тук, имайте търпение - в края на тази статия ще намерите 
разрешение. А за да избегенте подобнипроблеми, винаги изрично 
уведомявайте mysql какъв енкодинг да използва по време на всяка конекция
 (connection):<br>Код:<br><br>$link = mysql_connect('host', 'user', 'password');<br>mysql_query('set names utf8', $link);<br><br>По
 този начин, дори на сървъра character set по подразбиране да е cp1251, 
данните към и от сървъра за вашето php приложение ще се обменят в utf8 
encoding.<br><br>Експорт и импорт на база данни<br>За експортиране на 
база данни можете да ползвате phpmyadmin или mysqldump, които ще 
генерират тескотов файл (dump), със структурата и данните на вашата 
база. При големи бази данни е препоръчително да ползвате mysqldump 
(необходим ви е ssh достъп до сървъра). По подразбиране и двете програми
 ще генерират дъмп в utf-8 формат независимо с какъв чарсет е базата. 
Това е нормално и не е проблем. Енкодинга на файла е utf-8, но ако в 
базата таблиците са били с cp1251, това ще бъде отбелязано в sql кода за
 създаване на таблицата в самия дъмп файл.<br><br>Код:<br><br>/*!40101 SET NAMES utf8 */;<br><br>CREATE TABLE `mytable` (<br>`my_id` mediumint(8) unsigned NOT NULL auto_increment,<br>`my_text` varchar(100) default NULL<br>) ENGINE=MyISAM DEFAULT CHARSET=cp1251;<br><br>Това
 е дъмп създаден от mysqldump. Файлът е в unicode формат и това е 
отбелязано в самото начало. Така при импортиране на този файл след това 
mysql ще интерпретира символите правилно. Когато mysql види, че трябва 
да създаде таблицата в cp1251 чарсет и колация, той автоматично ще 
преведе чарсета от utf към cp1251. PhpMyAdmin ще направи подобен dump, 
но за съжаление ще пропусне 'SET NAMES' указанието. Това може да доведе 
до проблем, при импорт и е добре да го добавите. Ако не сте сигурни 
какъв точно е файловия енкодинг на вашия дъмп, можете да проверите по 
следния начин - дъмпа се отваря в Firefox (или друг браузър) и от View →
 Character Encoding се сменя докато кирилицата стане читаема. Запомня се
 при какъв чарсет се чете и това се записва в реда /*!40101 SET NAMES 
utf8 */;. Не забравяйте, че когато в браузъра е utf-8, трябва в дъмп 
файла да го запишете utf8, а windows-1251 като cp1251. Също така може да
 се ползва опцията за чарсет при ъплоуд в phpmyadmin.<br><br>Продължава ....
		</p>
		<p class="windowbg2">
			<b>Пенко Пенев</b>:<br>
			Продължение ...<br><br>Възстановяване на данни, въведени с неправилен енкодинг<br>Тук
 ще разгледаме случая когато базата данни и default connection 
(default-character-set = cp1251) са с кодировка cp1251, а самия сайт 
ползва utf-8. На пръв поглед всичко работи ок, но в действителност 
данните в базата са объркани. Проблема се оправя със следните стъпки:<br>1. С mysqldump се експортира базата, но се задава cp1251 чарсет:<br><br>Код:<br><br>mysqldump --default-character-set=cp1251 my_database &gt; my_database.sql<br><br>2.
 [Долуописания метод за конвертиране определено не е особено елегантен и
 ако някой предложи по-добър, получава 6 месеца безплатен хостинг!] 
Отваряте дъмпа в Firefox (ако е по-голям, чакате да спре да зарежда и 
дано имате повече рам). От View → Character Encoding сменяте на utf-8 и 
би трябвало да вдите кирилицата нормално. Не скролвайте по възможност 
много надолу, тъй като дългите редове убиват всеки текств редактор. С 
Ctrl + A селектвате всичко, копирате го и го paste-вате в Visual Studio.
 Тъй като сайта ви е настроен за utf-8, ще приемем, че желаете да 
уеднаквите всичко с него. Това означава, че базата данни и конекцията 
към нея трябва да станат utf8. Заменяте всички cp1251 с utf8, като 
използвате Replace All, а не едно по-едно за да не чакате дълго. Ако 
имате възможност заменяйте директно във файла (например под линукс: perl
 -pi -e "s/cp1251/utf8/g" database.sql). Давате му Save As, и в появилия
 се прозорец кликате на стрелкичката до бутона Save и изберате Unicode 
(UTF-8 without signature). Така сготвената база данни можете да 
поднесете наmysql:<br><br>Код:<br><br>mysql my_database &lt; my_database.sql<br><br>Не забравяйте да добавите в php кода след всяка конекция към базата:<br><br>Код:<br><br>$link = mysql_connect('host', 'user', 'password');<br>mysql_query('set names utf8', $link);<br><br><br>Край
		</p>
		<p class="windowbg">
			<b>plamen5rov</b>:<br>
			Penko ROCKS! 8)
		</p>
		<p class="titlebg">Навигация</p>
		<p class="windowbg">[0] <a href="http://archive.joomla.bg/forum/index.php?PHPSESSID=bb208294f95f26c136124c5fea758ba6&amp;board=2.0;wap2" accesskey="0">Индекс на мненията</a></p>
		<p class="windowbg">[#] <a href="http://archive.joomla.bg/forum/index.php?PHPSESSID=bb208294f95f26c136124c5fea758ba6&amp;topic=3165.15;wap2" accesskey="#">Следваща страница</a></p>
		<p class="windowbg">[*] <a href="http://archive.joomla.bg/forum/index.php?PHPSESSID=bb208294f95f26c136124c5fea758ba6&amp;topic=3165.5;wap2" accesskey="*">Предишна страница</a></p>
	
</body></html>